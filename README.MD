![Логотип NSUTASK](logotyp.jpg)

**NSUTASK** — это простая в настройке и использовании self-hosted веб канбан-доска для организации учебного процесса, где преподаватели в формате карточек до некторого срока могут создавать задачи, а ученики — легко отправлять свои решения на проверку.



## Установка и запуск

0. NSUTASK написан на **Node.JS**, поэтому перед запуском нужно сперва его установить (справедливо):
```
sudo apt install nodejs npm -y
```
1. Клонируйте репозиторий и перейдите в него:
```
git clone git@github.com:NSUTASK/NSUTASK.git
cd ./NSUTASK
```
2. Установите зависимости, также желательно поставить Nodemon для упрощения отладки:
```
npm i
npm i nodemon
```
3. Наконец, запустите проект и перейдите на `localhost:<ПОРТ>` для начала работы:
```
npm run test # <-- запуск под Nodemon
# ИЛИ
npm run serve # <-- запуск под Node
```
4. Для удобной отладки API можно использовать [**Insomnia**](https://insomnia.rest/download).
Файл с конфигурациями лежит в корне этого репозитория (`Insomnia_<ДАТА>.json`), для импорта нужно выбрать *Use the local Scratch Pad*, затем тыкнуть по *Scratch Pad* слева сверху и выбрать *Import*.



## Документация АРІ

**Все входные параметры и результаты имеют вид объектов JSON.**



### Users

<details>
<summary><big><code>login</code> (GET <code>../api/users/login</code>)</big></summary>
— получить session token пользователя.

Требуемые превилегии:
- (нет)

Параметры:
- username
- password

Результат:
- Код 200 и session_token, если авторизация успешна
- Код 401 и сообщение, если неверный пароль
- Код 404 и сообщение, если пользователь не найден
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>register</code> (GET <code>../api/users/register</code>)</big></summary>
— добавить нового пользователя в БД users.

Минимальные превилегии:
- (нет)

Параметры:
- username
- display_name
- password
- role\* ("operator" или "user")

*\* - Если в конфигурации проекта запрещено создание новых операторов, установка значения на "operator" приведёт к ошибке*

Результат:
- Код 201 и сообщение, если регистрация успешна
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getUsers</code> (GET <code>../api/users</code>)</big></summary>
— получить список ID всех пользователей.

Минимальные привилегии:
- **user**

Параметры:
- (нет)

Результат:
- Код 200 и список ID пользователей
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getUser</code> (GET <code>../api/user[user_id]</code>)</big></summary>
— получить краткую информацию о пользователе по его ID.

Минимальные привилегии:
- **user**

Параметры:
- user_id

Результат:
- Код 200 и информация о пользователе (id, username, display_name)
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>findUsers</code> (GET <code>../api/users/find?q=[q]</code>)</big></summary>
— найти пользователей по username или display_name.

Требуемые привилегии:
- **user**

Параметры:
- q (поисковый запрос; может включать как никнейм, тик и отображаемое имя пользователя)

Результат:
- Код 200 и список найденных пользователей (id, username, display_name)
- Код 400 и сообщение, если поисковый запрос пустой
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getRole</code> (GET <code>../api/users/role</code>)</big></summary>
— получить роль текущего пользователя. Получить роль других пользователей **нельзя**.

Требуемые привилегии:
- **user**

Параметры:
- (нет)

Результат:
- Код 200 и роль текущего пользователя
- Код 500 и сообщение, если произошла ошибка
</details>



### Boards

<details>
<summary><big><code>getUserBoards</code> (GET <code>../api/boards</code>)</big></summary>
— получить список ID всех досок, в которых пользователь является участником.

Требуемые привилегии:
- **user**

Параметры:
- (нет)

Результат:
- Код 200 и список ID досок
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getBoardInfo</code> (GET <code>../api/board[board_id]</code>)</big></summary>
— получить информацию о доске и её конфигурации по ID доски.

Требуемые привилегии:
- **user**

Параметры:
- board_id

Результат:
- Код 200 и информация о доске и её конфигурации
- Код 404 и сообщение, если доска не найдена или пользователь не является её участником
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>createBoard</code> (POST <code>../api/boards</code>)</big></summary>
— создать новую доску.

Требуемые привилегии:
- **operator**

Параметры:
- name
- description
- configSubmitsAutoaccept\* (0 или 1)
- configSubmitsBodyMin\* (больше нуля)
- configSubmitsStrictDueDate\* (0 или 1)

*\* - Необязательные параметры; по умолчанию задаются как 0, 1 и 0 соответственно*

Результат:
- Код 201 и ID созданной доски, если доска создана
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>editBoardInfo</code> (PUT <code>../api/board[board_id]</code>)</big></summary>
— изменить информацию и конфигурацию доски по ID доски.

Требуемые привилегии:
- **operator**

Параметры:
- board_id
- name
- description
- configSubmitsAutoaccept\* (0 или 1)
- configSubmitsBodyMin\* (больше нуля)
- configSubmitsStrictDueDate\* (0 или 1)

*\* - Необязательные параметры; по умолчанию задаются как 0, 1 и 0 соответственно*

Результат:
- Код 200 и ID доски, если обновление успешно
- Код 404 и сообщение, если доска не найдена или пользователь не является её участником
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>deleteBoard</code> (DELETE <code>../api/board[board_id]</code>)</big></summary>
— удалить доску по ID.

Требуемые привилегии:
- **operator\***

*\* - Оператор должен являться создателем этой доски, иначе выполнение приведёт к ошибке*

Параметры:
- board_id

Результат:
- Код 201 и ID удаленной доски, если доска удалена
- Код 403 и сообщение, если пользователь не является создателем доски
- Код 404 и сообщение, если доска не найдена
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getMember</code> (GET <code>../api/board[board_id]/users</code>)</big></summary>
— получить список всех участников доски по ID доски.

Требуемые привилегии:
- **operator**

Параметры:
- board_id

Результат:
- Код 200 и список участников доски
- Код 404 и сообщение, если доска не найдена или пользователь не является её участником
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>addMember</code> (POST <code>../api/board[board_id]/user[user_id]</code>)</big></summary>
— добавить участника в доску по ID доски и ID пользователя.

Требуемые привилегии:
- **operator**

Тело запроса:
- board_id
- user_id

Результат:
- Код 201 и ID добавленного участника
- Код 400 и сообщение, если пользователь уже является участником доски
- Код 404 и сообщение, если доска или пользователь не найдены
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>deleteMember</code> (DELETE <code>../api/board[board_id]/user[user_id]</code>)</big></summary>
— удалить участника из доски по ID доски и ID пользователя.

Требуемые привилегии:
- **user**

Параметры:
- board_id
- user_id

Результат:
- Код 200 и ID удаленного участника
- Код 400 и сообщение, если пользователь пытается удалить самого себя
- Код 404 и сообщение, если доска или пользователь не найдены
- Код 500 и сообщение, если произошла ошибка
</details>



### Tasks

<details>
<summary><big><code>getBoardTasks</code> (GET <code>../api/boards[board_id]/tasks</code>)</big></summary>
— получить все задачи на доске.

Требуемые привилегии:
- **user**

Параметры:
- `board_id`

Результат:
- Код 200 и список задач, если запрос успешен
- Код 404 и сообщение, если доска не найдена или пользователь не является её участником
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getTaskInfo</code> (GET <code>../api/board[board_id]/tasks[task_id]</code>)</big></summary>
— получить информацию о задаче по её ID.

Требуемые привилегии:
- **user**

Параметры:
- `board_id`
- `task_id`

Результат:
- Код 200 и информация о задаче (id, title, body, date_created, date_due, priority)
- Код 404 и сообщение, если доска или задача не найдены, или пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>createTask</code> (POST <code>../api/board[board_id]/tasks</code>)</big></summary>
— создать новую задачу на доске.

Требуемые привилегии:
- **operator**

Параметры:
- `board_id`
- `title`
- `body`\* (текст задачи)
- `dateDue`\* (срок выполнения задачи в формате ISO)
- `priority`\* (приоритет задачи, "low", "normal" или "high")

*\* — Необязательные параметры*

Результат:
- Код 201 и ID новой задачи, если задача успешно создана
- Код 400 и сообщение, если передан некорректный приоритет или формат даты
- Код 404 и сообщение, если доска не найдена или пользователь не является её участником
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>editTaskInfo</code> (PUT <code>../api/board[board_id]/task[task_id]</code>)</big></summary>
— изменить информацию о задаче.

Требуемые привилегии:
- **operator**

Параметры:
- `board_id`
- `task_id`
- `title`
- `body`\* (текст задачи)
- `dateDue`\* (срок выполнения задачи в формате ISO)
- `priority`\* (приоритет задачи, "low", "normal" или "high")

*\* — Необязательные параметры*

Результат:
- Код 200 и ID задачи, если изменение успешно
- Код 400 и сообщение, если передан некорректный приоритет или формат даты
- Код 404 и сообщение, если доска или задача не найдены, или пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>deleteTask</code> (DELETE <code>../api/board[board_id]/task[task_id]</code>)</big></summary>
— удалить задачу.

Требуемые привилегии:
- **operator**

Параметры:
- `board_id`
- `task_id`

Результат:
- Код 200 и ID удаленной задачи, если удаление успешно
- Код 404 и сообщение, если доска или задача не найдены, или пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>



### Submits

<details>
<summary><big><code>getSubmitInfo</code> (GET <code>../api/board[board_id]/task[task_id]/submit[submit_id]</code>)</big></summary>
— получить информацию о посылке.

Требуемые привилегии:
- **user**

Параметры:
- `board_id`
- `task_id`
- `submit_id`

Результат:
- Код 200 и информация о посылке (id, user_id, task_id, date_submitted, text, status)
- Код 404 и сообщение, если доска, задача или посылка не найдены, либо пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>createSubmit</code> (POST <code>../api/board[board_id]/task[task_id]/submits</code>)</big></summary>
— создать новую посылку для задачи.

Требуемые привилегии:
- **user**

Параметры:
- `board_id`
- `task_id`
- `body`

Результат:
- Код 201 и ID новой посылки, если посылка успешно создана
- Код 400 и сообщение, если посылка не соответствует требованиям (например, body имеет недостаточную длину)
- Код 404 и сообщение, если доска или задача не найдены, либо пользователь не является участником доски
- Код 409 и сообщение, если пользователь уже отправлял посылку для этой задачи
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>deleteSubmit</code> (DELETE <code>../api/board[board_id]/task[task_id]/submit[submit_id]</code>)</big></summary>
— удалить посылку.

Требуемые привилегии:
- **user**

Параметры:
- `board_id`
- `task_id`
- `submit_id`

Результат:
- Код 200 и ID удаленной посылки, если удаление успешно
- Код 404 и сообщение, если доска, задача или посылка не найдены, либо пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getTaskSubmits</code> (GET <code>../api/board[board_id]/task[task_id]/submits</code>)</big></summary>
— получить все посылки для задачи.

Требуемые привилегии:
- **operator**

Параметры:
- `board_id`
- `task_id`

Результат:
- Код 200 и список посылок, если запрос успешен
- Код 404 и сообщение, если доска или задача не найдены, либо пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>setSubmitStatus</code> (PUT <code>../api/boards[board_id]/tasks[task_id]/submits[submit_id]</code>)</big></summary>
— изменить статус посылки.

Требуемые привилегии:
- **operator**

Параметры:
- `board_id`
- `task_id`
- `submit_id`
- `status` (новый статус посылки, "accepted" либо "rejected")

Результат:
- Код 200 и ID посылки, если изменение успешно
- Код 400 и сообщение, если передан некорректный статус
- Код 404 и сообщение, если доска, задача или посылка не найдены, либо пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>
