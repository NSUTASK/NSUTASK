![Логотип NSUTASK](public/assets/logo.png)

**NSUTASK** — это удобная и простая в настройке и использовании web-канбан-доска для организации учебного процесса. Преподаватели могут создавать задачи в виде карточек с указанием сроков выполнения, а студенты — отправлять для них решения на проверку.

Это веб-приложение работает на основе Node.js и Express для бэкенда, без использования дополнительных фреймворков для клиента.



## Установка и запуск

0. Установите Node.JS (нужен для запуска проекта):

    ```
    sudo apt install nodejs npm -y
    ```

1. Клонируйте репозиторий и перейдите в него:

    ```
    git clone git@github.com:NSUTASK/NSUTASK.git
    cd ./NSUTASK
    ```

2. Установите зависимости:

    ```
    npm i
    ```

3. Наконец, запустите проект и перейдите на `localhost:<ПОРТ>` для начала работы:

    ```
    npm run test # <-- запуск под Nodemon
    # ИЛИ
    npm run serve # <-- запуск под Node
    ```

4. Для удобной отладки API можно использовать программу [**Insomnia**](https://insomnia.rest/download).

    Файл с конфигурациями для неё лежит в корне этого репозитория (`Insomnia_<ДАТА>.json`). Для импорта конфигурций, в приветственном окне программы нужно выбрать *Use the local Scratch Pad*, затем раскрыть меню *Scratch Pad* (слева сверху) и выбрать *Import*.



## Документация АРІ

*Все входные параметры и результаты имеют вид объектов JSON.*

*Звёдочкой (\*) отмечены НЕОБЯЗАТЕЛЬНЫЕ ПАРАМЕТРЫ.*



### Users

<details>
<summary><big><code>login</code> (POST <code>../api/login</code>)</big></summary>

— войти в систему.

**Требуемые привилегии:** (нет)

**Параметры:**
- `username` — имя пользователя
- `password` — пароль пользователя

**Результат:**
- Код 200 и session_token, если вход успешен
- Код 401 и сообщение, если пароль неверен
- Код 404 и сообщение, если пользователь не найден
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>register</code> (POST <code>../api/register</code>)</big></summary>

— зарегистрировать нового пользователя.

**Требуемые привилегии:** (нет)

**Параметры:**
- `username` — имя пользователя
- `display_name` — отображаемое имя пользователя
- `password` — пароль пользователя
- `role` — роль пользователя (user или operator)

**Результат:**
- Код 201 и сообщение об успешной регистрации
- Код 403 и сообщение, если создание операторов запрещено
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getRole</code> (GET <code>../api/role</code>)</big></summary>

— получить роль текущего пользователя.

**Требуемые привилегии:** `user`

**Параметры:**
- Нет

**Результат:**
- Код 200 и роль пользователя (role)
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getUsers</code> (GET <code>../api/users</code>)</big></summary>

— получить список всех пользователей.

**Требуемые привилегии:** `operator`

**Параметры:**
- Нет

**Результат:**
- Код 200 и список пользователей (id)
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getUser</code> (GET <code>../api/users/:user_id</code>)</big></summary>

— получить информацию о пользователе.

**Требуемые привилегии:** `operator`

**Параметры:**
- `user_id` — ID пользователя

**Результат:**
- Код 200 и информация о пользователе (id, username, display_name)
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>findUsers</code> (GET <code>../api/users/search</code>)</big></summary>

— найти пользователей по имени пользователя или отображаемому имени.

**Требуемые привилегии:** `operator`

**Параметры:**
- `q` — поисковый запрос (query-параметр)

**Результат:**
- Код 200 и список найденных пользователей (id, username, display_name)
- Код 400 и сообщение, если запрос пустой
- Код 500 и сообщение, если произошла ошибка
</details>



### Boards

<details>
<summary><big><code>getUserBoards</code> (GET <code>../api/boards</code>)</big></summary>

— получить список досок пользователя.

**Требуемые привилегии:** `user`

**Параметры:**
- Нет

**Результат:**
- Код 200 и список досок пользователя
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getBoardInfo</code> (GET <code>../api/boards/:board_id</code>)</big></summary>

— получить информацию о доске.

**Требуемые привилегии:** `user`

**Параметры:**
- `board_id` — ID доски

**Результат:**
- Код 200 и информация о доске (board и config)
- Код 404 и сообщение, если доска не найдена или пользователь не является её участником
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>createBoard</code> (POST <code>../api/boards</code>)</big></summary>

— создать новую доску.

**Требуемые привилегии:** `operator`

**Параметры:**
- `name` — название доски
- `description` — описание доски
- `configSubmitsAutoaccept`\* — автоматическое принятие посылок (0 или 1)
- `configSubmitsBodySize`\* — размер тела посылки (целое число)
- `configSubmitsStrictDueDate`\* — строгая дата выполнения (0 или 1)

**Результат:**
- Код 201 и ID новой доски
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>editBoardInfo</code> (PUT <code>../api/boards/:board_id</code>)</big></summary>

— изменить информацию о доске.

**Требуемые привилегии: `operator`

**Параметры:**
- `board_id` — ID доски
- `name` — новое название доски
- `description` — новое описание доски
- `configSubmitsAutoaccept`\* — автоматическое принятие посылок (0 или 1)
- `configSubmitsBodySize`\* — размер тела посылки (целое число)
- `configSubmitsStrictDueDate`\* — строгая дата выполнения (0 или 1)

**Результат:**
- Код 200 и ID обновлённой доски
- Код 404 и сообщение, если доска не найдена или пользователь не является её участником
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>deleteBoard</code> (DELETE <code>../api/boards/:board_id</code>)</big></summary>

— удалить доску.

**Требуемые привилегии:** `operator`

**Параметры:**
- `board_id` — ID доски

**Результат:**
- Код 201 и ID удалённой доски
- Код 403 и сообщение, если пользователь не является создателем доски
- Код 404 и сообщение, если доска не найдена
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getMembers</code> (GET <code>../api/boards/:board_id/members</code>)</big></summary>

— получить список участников доски.

**Требуемые привилегии:** `user`

**Параметры:**
- `board_id` — ID доски

**Результат:**
- Код 200 и список участников доски
- Код 404 и сообщение, если доска не найдена или пользователь не является её участником
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>addMember</code> (POST <code>../api/boards/:board_id/members/:user_id</code>)</big></summary>

— добавить участника в доску.

**Требуемые привилегии:** `user`

**Параметры:**
- `board_id` — ID доски
- `user_id` — ID пользователя

**Результат:**
- Код 201 и ID добавленного участника
- Код 400 и сообщение, если пользователь уже является участником доски
- Код 404 и сообщение, если доска или пользователь не найдены, либо пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>deleteMember</code> (DELETE <code>../api/boards/:board_id/members/:user_id</code>)</big></summary>

— удалить участника из доски.

**Требуемые привилегии:** `user`

**Параметры:**
- `board_id` — ID доски
- `user_id` — ID пользователя

**Результат:**
- Код 200 и ID удалённого участника
- Код 400 и сообщение, если пользователь пытается удалить самого себя
- Код 404 и сообщение, если доска или пользователь не найдены, либо пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>



### Tasks

<details>
<summary><big><code>getBoardTasks</code> (GET <code>../api/boards/:board_id/tasks</code>)</big></summary>

— получить список задач на доске.

**Требуемые привилегии:** `user`

**Параметры:**
- `board_id` — ID доски

**Результат:**
- Код 200 и список задач на доске (включая количество посылок для каждой задачи)
- Код 404 и сообщение, если доска не найдена или пользователь не является её участником
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getTaskInfo</code> (GET <code>../api/boards/:board_id/tasks/:task_id</code>)</big></summary>

— получить информацию о задаче.

**Требуемые привилегии:** `user`

**Параметры:**
- `board_id` — ID доски
- `task_id` — ID задачи

**Результат:**
- Код 200 и информация о задаче (включая количество посылок)
- Код 404 и сообщение, если доска или задача не найдены, либо пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>createTask</code> (POST <code>../api/boards/:board_id/tasks</code>)</big></summary>

— создать новую задачу на доске.

**Требуемые привилегии:** `operator`

**Параметры:**
- `board_id` — ID доски
- `title` — заголовок задачи
- `body`\* — описание задачи
- `dateDue`\* — срок выполнения задачи

**Результат:**
- Код 201 и ID новой задачи
- Код 400 и сообщение, если формат даты неверный или срок выполнения в прошлом
- Код 404 и сообщение, если доска не найдена или пользователь не является её участником
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>editTaskInfo</code> (PUT <code>../api/boards/:board_id/tasks/:task_id</code>)</big></summary>

— изменить информацию о задаче на доске.

**Требуемые привилегии:** `operator`

**Параметры:**
- `board_id` — ID доски
- `task_id` — ID задачи
- `title` — новый заголовок задачи
- `body`\* — новое описание задачи
- `dateDue`\* — новый срок выполнения задачи

**Результат:**
- Код 200 и ID обновлённой задачи
- Код 400 и сообщение, если формат даты неверный или срок выполнения в прошлом
- Код 404 и сообщение, если доска или задача не найдены, либо пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>deleteTask</code> (DELETE <code>../api/boards/:board_id/tasks/:task_id</code>)</big></summary>

— удалить задачу с доски.

**Требуемые привилегии:** `operator`

**Параметры:**
- `board_id` — ID доски
- `task_id` — ID задачи

**Результат:**
- Код 200 и ID удалённой задачи
- Код 404 и сообщение, если доска или задача не найдены, либо пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>



### Submits

<details>
<summary><big><code>getBoardSubmits</code> (GET <code>../api/board:board_id/submits</code>)</big></summary>

— получить все посылки пользователя на доске.

Требуемые привилегии: `user`

Параметры:
- `board_id` — ID доски

Результат:
- Код 200 и список посылок (task_id, status)
- Код 404 и сообщение, если доска не существует или пользователь не является её участником
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getSubmitInfo</code> (GET <code>../api/board:board_id/task:task_id/submit:submit_id</code>)</big></summary>

— получить информацию о посылке.

Требуемые привилегии: `user`

Параметры:
- `board_id` — ID доски
- `task_id` — ID задачт
- `submit_id` — ID посылки

Результат:
- Код 200 и информация о посылке (id, user_id, task_id, date_submitted, text, status)
- Код 404 и сообщение, если доска, задача или посылка не найдены, либо пользователь не является участником доски
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>createSubmit</code> (POST <code>../api/board:board_id/task:task_id/submit</code>)</big></summary>

— создать новую посылку для задачи.

Требуемые привилегии: `user`

Параметры:
- `board_id` — ID доски
- `task_id` — ID задачт
- `body` — текст посылки

Результат:
- Код 201 и ID посылки, если успешно
- Код 400 и сообщение, если тело посылки слишком короткое или срок сдачи задачи истёк
- Код 404 и сообщение, если доска, задача или пользователь не найдены
- Код 409 и сообщение, если посылка уже существует
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>deleteSubmit</code> (DELETE <code>../api/board:board_id/task:task_id/submit</code>)</big></summary>

— удалить существующую посылку.

Требуемые привилегии: `user`

Параметры:
- `board_id` — ID доски
- `task_id` — ID задачи

Результат:
- Код 200 и ID посылки, если успешно
- Код 400 и сообщение, если посылка уже принята
- Код 404 и сообщение, если посылка не найдена
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getTaskSubmits</code> (GET <code>../api/board:board_id/task:task_id/submits</code>)</big></summary>

— получить все посылки для задачи.

Требуемые привилегии: `operator`

Параметры:
- `board_id` — ID доски
- `task_id` — ID задачи

Результат:
- Код 200 и список ID посылок
- Код 404 и сообщение, если доска или задача не найдены
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>getTaskSubmit</code> (GET <code>../api/board:board_id/task:task_id/submit:submit_id</code>)</big></summary>

— получить информацию о посылке для задачи.

Требуемые привилегии: `operator`

Параметры:
- `board_id` — ID доски
- `task_id` — ID задачи
- `submit_id` — ID посылки

Результат:
- Код 200 и информация о посылке (id, user_id, task_id, date_submitted, text, status, username, display_name)
- Код 404 и сообщение, если доска, задача, посылка или пользователь не найдены
- Код 500 и сообщение, если произошла ошибка
</details>

<details>
<summary><big><code>setSubmitStatus</code> (PUT <code>../api/board:board_id/task:task_id/submit:submit_id</code>)</big></summary>

— изменить статус посылки.

Требуемые привилегии: `operator`

Параметры:
- `board_id` — ID доски
- `task_id` — ID задачи
- `submit_id` — ID посылки
- `status` — новый статус (`accepted`, `rejected` или `pending`)

Результат:
- Код 200 и ID посылки, если успешно
- Код 400 и сообщение, если указан некорректный статус
- Код 404 и сообщение, если доска, задача или посылка не найдены
- Код 500 и сообщение, если произошла ошибка
</details>
